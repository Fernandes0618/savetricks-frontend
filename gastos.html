<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gastos - SaveTricks</title>
</head>
<body>
  <h1>Gastos</h1>
  <form id="expense-form">
    <label>Valor: <input type="number" step="0.01" id="amount" required></label><br>
    <label>Categoria: 
      <select id="category" required>
        <option value="Alimentação">Alimentação</option>
        <option value="Transporte">Transporte</option>
        <option value="Moradia">Moradia</option>
        <option value="Lazer">Lazer</option>
        <option value="Saúde">Saúde</option>
        <option value="Educação">Educação</option>
        <option value="Outros">Outros</option>
      </select>
    </label><br>
    <label>Data: <input type="date" id="date" required></label><br>
    <button type="submit">Adicionar gasto</button>
  </form>

  <ul id="expense-list"></ul>

  <script>
    const apiUrl = "https://savetricks-backend.onrender.com";
    const userId = localStorage.getItem("usuario_id");

    document.getElementById("expense-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const amount = parseFloat(document.getElementById("amount").value);
      const category = document.getElementById("category").value;
      const date = document.getElementById("date").value;

      fetch(apiUrl + "/api/gastos", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          usuario_id: userId,
          valor: amount,
          categoria: category,
          data: date
        })
      }).then(() => loadExpenses());
    });

    function loadExpenses() {
      fetch(apiUrl + "/api/gastos/" + userId)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById("expense-list");
          list.innerHTML = "";
          data.forEach(exp => {
            const item = document.createElement("li");
            item.textContent = `R$ ${exp.valor.toFixed(2)} - ${exp.categoria} - ${exp.data}`;
            list.appendChild(item);
          });
        });
    }

    loadExpenses();
  </script>
</body>
</html>